#Raspberry Pi
import paho.mqtt.client as mqtt
import time

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á MQTT Broker (Raspberry Pi ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô Mosquitto)
broker_address = "192.168.1.100"  # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô IP ‡∏Ç‡∏≠‡∏á Raspberry Pi 5
topic = "arduino/command"

# ‡∏™‡∏£‡πâ‡∏≤‡∏á MQTT Client
client = mqtt.Client()

# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö MQTT Broker
def connect_mqtt():
    while True:
        try:
            client.connect(broker_address, 1883, 60)
            print("‚úÖ MQTT Connected")
            break
        except Exception as e:
            print(f"‚ö†Ô∏è Failed to connect: {e}, retrying...")
            time.sleep(5)  # ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

connect_mqtt()  # ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å

while True:
    command = input("Enter command (MOTOR_ON / MOTOR_OFF / EXIT): ").strip().upper()
    
    if command in ["MOTOR_ON", "MOTOR_OFF"]:
        client.publish(topic, command)
        print(f"üì§ Sent command: {command}")
    elif command == "EXIT":
        print("üö™ Exiting program...")
        break
    else:
        print("‚ö†Ô∏è Invalid command. Try again.")